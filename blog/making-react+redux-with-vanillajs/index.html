<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/0.b35ffec065a7690a7e4c.css">@font-face{font-family:Audiowide;font-style:normal;font-display:swap;font-weight:400;src:local("Audiowide Regular "),local("Audiowide-Regular"),url(/static/audiowide-latin-400-e7baaa254eca5c280dc22655698c7f7c.woff2) format("woff2"),url(/static/audiowide-latin-400-b999feca7fc70d2d0bcbd4658d044270.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style data-href="/component---src-templates-blog-post-index-js.7c2f59b6026c47fa589f.css">@import url(https://fonts.googleapis.com/css?family=Audiowide);nav.navbar{position:static}h1,h2,h3,h4,h5,h6{font-family:Audiowide,cursive}body{font-size:16px}#blog-post{font-size:1.25rem;max-width:980px;margin:0 auto}#blog-post pre{margin-bottom:3rem;font-size:1rem}#blog-post h1:not(:first-child){margin-top:5rem}#blog-post h4{margin-top:3rem}</style><meta name="generator" content="Gatsby 2.0.31"/><title data-react-helmet="true">Sam Wemyss</title><meta data-react-helmet="true" name="description" content="Personal website for Sam Wemyss"/><meta data-react-helmet="true" name="keywords" content="software developer, student, javascript, programming"/><link as="script" rel="preload" href="/component---src-templates-blog-post-index-js-52e504df73af2210919b.js"/><link as="script" rel="preload" href="/0-4398f76fd40fa36457da.js"/><link as="script" rel="preload" href="/app-a450b1e5cfa5a17fbb36.js"/><link as="script" rel="preload" href="/webpack-runtime-a451f1c81e7d2f14d949.js"/><link rel="preload" href="/static/d/427/path---blog-making-react-redux-with-vanillajs-503-9ea-3GXmcbCVWyWroEFsO2OndxpCeVo.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><main><nav class="navbar is-dark has-shadow"><div class="navbar-start navbar-end navbar-brand"><a class="navbar-item" href="/"><h2>Home</h2></a><a class="navbar-item" href="/about"><h2>About</h2></a><a class="navbar-item" href="/blog"><h2>Blog</h2></a></div></nav><div class="hero is-medium is-primary is-bold"><div class="hero-body"><div class="section"><div class="container"><h1 class="title">Making React + Redux in VanillaJS (kind of)</h1><h2 class="subtitle">April 17, 2018</h2></div></div></div></div><div class="section"><div class="container"><div id="blog-post" class="content"><p>So I wanted to make a simple prototype for a webapp thing I need to build in my thesis, and I got all excited thinking about all the cool libraries and patterns I could use to build something that is basically just Photo Booth.app... Overkill much ü§¶‚Äç‚ôÄÔ∏è</p>
<p>After coming to the conclusion I don't need <em>React + (insert long list of currently popular libraries that solve a problem you don't have but still need to solve for some reason)</em> I set out to just make it in plain JS - nice and simple!</p>
<p>As a bit of a challenge I wanted to make my app state-driven (e.g. in <strong>React/Redux</strong>, if the state changes the relevant components/subscribers get updated). This was something I've always enjoyed about React so I thought it would be fun to roll my own version of it (don't worry, I'm not making another JS framework üò¨).</p>
<p>This was the hacky solution I came up with:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Global store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token punctuation">{</span>
	myone<span class="token punctuation">:</span> <span class="token number">123</span><span class="token punctuation">,</span>

	<span class="token comment">// Key containing some todos data</span>
	todos<span class="token punctuation">:</span> <span class="token punctuation">[</span>
		<span class="token punctuation">{</span>
			text<span class="token punctuation">:</span> <span class="token string">'My first todo'</span><span class="token punctuation">,</span>
			completed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span>
			text<span class="token punctuation">:</span> <span class="token string">'Another todo that I have done'</span><span class="token punctuation">,</span>
			completed<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>

	otherData<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

	andSomeMore<span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
	
	<span class="token comment">// Listeners to notify based on updates to particular keys</span>
	listeners<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token comment">/*
	*  Subscribe a function to "listen" to any changes made to the store[key] data
	*  @param keys - single string key or an array of keys to listen to
	*  @param listener - function to call when data changes
	*/</span>
	subscribe<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> arrKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">of</span> arrKeys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token comment">/*
	*  Update data in the store and notify any relevant listeners.
	*  @param key - key to update in the store
	*  @param data - data to place at that key
	*/</span>
	update<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>key <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Key: (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) not in store object`</span></span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Attempted updating store with the same state'</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		store<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> data
	
		<span class="token comment">// Call all listeners of this key</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> listener <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listeners<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Simple but shortsighted, I don't handle adding new keys, prevent direct mutation of the store, handle actions nicely with reducers etc. But we can update the todos data using <code class="language-text">update()</code> and expect all listeners to be notified about it, we can use this then to re-render the "components"!</p>
<p>So below is an example of the very basic "component" structure that I used. Key parts namely are the reference to the node in the DOM (if it had one) and the render function which returns a HTML string.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Component (you could do this using a class)</span>
<span class="token keyword">const</span> TodoList <span class="token operator">=</span> <span class="token punctuation">{</span>

	<span class="token comment">// DOM element the component connects to on the html page</span>
	elem<span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'todo_list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	
	<span class="token comment">// Replace element with newly rendered html</span>
	update<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>elem<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	
	<span class="token comment">// Genreate HTML string representing element</span>
	render<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token template-string"><span class="token string">`&lt;ul>
			</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=></span> `<span class="token operator">&lt;</span>li<span class="token operator">></span>$<span class="token punctuation">{</span>Todo<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li>`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>`	<span class="token comment">// Hmmm. The highlighter breaks on nested template literals...</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
TodoList<span class="token punctuation">.</span>update <span class="token operator">=</span> TodoList<span class="token punctuation">.</span>update<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">)</span>

<span class="token comment">// Subscribe to the 'todos' data, call update() everytime it gets updated</span>
store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> TodoList<span class="token punctuation">.</span>update<span class="token punctuation">)</span></code></pre></div>
<p>As you can see I use <code class="language-text">store.subscribe()</code> to listen to the <code class="language-text">&#39;todos&#39;</code> key and call the <code class="language-text">TodoList.update()</code> function every time there is a change. Simple right!</p>
<p>So what does this actually mean, well anywhere else in my code I can call <code class="language-text">store.update()</code> and expect that any re-rendering will be automatically triggered.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// Add a new todo to the store</span>
store<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">'todos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token operator">...</span>store<span class="token punctuation">.</span>todos<span class="token punctuation">,</span>
	<span class="token punctuation">{</span>
		text<span class="token punctuation">:</span> <span class="token string">'A new todo item'</span><span class="token punctuation">,</span>
		completed<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Magic happens and things re-render! üéâ</span></code></pre></div>
<p>Anyways, the prototype was actually pretty quick to build this way. I think it was rather useful to build something like this from scratch and form your own patterns to understand the design decisions behind some of these awesome libraries/frameworks that are available now.</p>
<p>That's me done for now, have a wonderful day! üåà</p></div></div></div></main></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-index-js","jsonName":"blog-making-react-redux-with-vanillajs-503","path":"/blog/making-react+redux-with-vanillajs"};window.dataPath="427/path---blog-making-react-redux-with-vanillajs-503-9ea-3GXmcbCVWyWroEFsO2OndxpCeVo";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a450b1e5cfa5a17fbb36.js"],"component---src-templates-blog-post-index-js":["/component---src-templates-blog-post-index-js.7c2f59b6026c47fa589f.css","/component---src-templates-blog-post-index-js-52e504df73af2210919b.js"],"component---src-pages-404-js":["/component---src-pages-404-js.867d3e9030b0b82bcc5e.css","/component---src-pages-404-js-592a7d51ea466dda9cfe.js"],"component---src-pages-about-js":["/component---src-pages-about-js.46433f07603e8b3a2c4a.css","/component---src-pages-about-js-8533eccf02c30350f3dc.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js.a4536e96b2cef7ae18f5.css","/component---src-pages-blog-js-66bcc3857f8c28378e29.js"],"component---src-pages-index-js":["/component---src-pages-index-js.b29b7f9a5668f41b519f.css","/component---src-pages-index-js-523fae4f3f3663276208.js"]};/*]]>*/</script><script src="/webpack-runtime-a451f1c81e7d2f14d949.js" async=""></script><script src="/app-a450b1e5cfa5a17fbb36.js" async=""></script><script src="/0-4398f76fd40fa36457da.js" async=""></script><script src="/component---src-templates-blog-post-index-js-52e504df73af2210919b.js" async=""></script></body></html>